import React, { createContext, useContext, useState, useEffect } from 'react';
import type { ReactNode } from 'react';

export type ColorPalette = 'default' | 'light' | 'ocean' | 'sunset' | 'night' | 'mono';

export interface ThemeContextType {
  currentPalette: ColorPalette;
  setPalette: (palette: ColorPalette) => void;
  availablePalettes: Array<{
    id: ColorPalette;
    name: string;
    description: string;
    primaryColor: string;
  }>;
}

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export const availablePalettes = [
  {
    id: 'default' as ColorPalette,
    name: 'Domyślna',
    description: 'Ciemna paleta z niebieskimi akcentami',
    primaryColor: '#0ea5e9',
  },
  {
    id: 'light' as ColorPalette,
    name: 'Jasna',
    description: 'Jasna paleta z zielonymi i żółtymi akcentami',
    primaryColor: '#22c55e',
  },
  {
    id: 'ocean' as ColorPalette,
    name: 'Oceaniczna',
    description: 'Paleta inspirowana oceanem z turkusowymi tonami',
    primaryColor: '#0ea5e9',
  },
  {
    id: 'sunset' as ColorPalette,
    name: 'Zachód słońca',
    description: 'Ciepła paleta z pomarańczowymi i różowymi tonami',
    primaryColor: '#f97316',
  },
  {
    id: 'night' as ColorPalette,
    name: 'Nocna',
    description: 'Ciemna paleta z fioletowymi akcentami',
    primaryColor: '#a855f7',
  },
  {
    id: 'mono' as ColorPalette,
    name: 'Monochromatyczna',
    description: 'Elegancka paleta w odcieniach szarości',
    primaryColor: '#64748b',
  },
];

interface ThemeProviderProps {
  children: ReactNode;
}

export const ThemeProvider: React.FC<ThemeProviderProps> = ({ children }) => {
  const [currentPalette, setCurrentPalette] = useState<ColorPalette>('default');

  // Ładowanie zapisanej palety z localStorage
  useEffect(() => {
    const savedPalette = localStorage.getItem('colorPalette') as ColorPalette;
    if (savedPalette && availablePalettes.some(p => p.id === savedPalette)) {
      setCurrentPalette(savedPalette);
    }
  }, []);

  // Zapisanie palety do localStorage
  const setPalette = (palette: ColorPalette) => {
    setCurrentPalette(palette);
    localStorage.setItem('colorPalette', palette);
    
    // Aktualizacja CSS custom properties
    updateCSSVariables(palette);
  };

  // Aktualizacja CSS custom properties na podstawie wybranej palety
  const updateCSSVariables = (palette: ColorPalette) => {
    const root = document.documentElement;
    
    // Mapowanie palet na CSS custom properties
    const paletteMap = {
      default: {
        '--color-primary-50': '#f0f9ff',
        '--color-primary-100': '#e0f2fe',
        '--color-primary-200': '#bae6fd',
        '--color-primary-300': '#7dd3fc',
        '--color-primary-400': '#38bdf8',
        '--color-primary-500': '#0ea5e9',
        '--color-primary-600': '#0284c7',
        '--color-primary-700': '#0369a1',
        '--color-primary-800': '#075985',
        '--color-primary-900': '#0c4a6e',
        '--color-primary-950': '#082f49',
        '--color-secondary-50': '#f8fafc',
        '--color-secondary-100': '#f1f5f9',
        '--color-secondary-200': '#e2e8f0',
        '--color-secondary-300': '#cbd5e1',
        '--color-secondary-400': '#94a3b8',
        '--color-secondary-500': '#64748b',
        '--color-secondary-600': '#475569',
        '--color-secondary-700': '#334155',
        '--color-secondary-800': '#1e293b',
        '--color-secondary-900': '#0f172a',
        '--color-secondary-950': '#020617',
        '--color-accent-50': '#fdf4ff',
        '--color-accent-100': '#fae8ff',
        '--color-accent-200': '#f5d0fe',
        '--color-accent-300': '#f0abfc',
        '--color-accent-400': '#e879f9',
        '--color-accent-500': '#d946ef',
        '--color-accent-600': '#c026d3',
        '--color-accent-700': '#a21caf',
        '--color-accent-800': '#86198f',
        '--color-accent-900': '#701a75',
        '--color-accent-950': '#4a044e',
        '--color-error-50': '#fef2f2',
        '--color-error-100': '#fee2e2',
        '--color-error-200': '#fecaca',
        '--color-error-300': '#fca5a5',
        '--color-error-400': '#f87171',
        '--color-error-500': '#ef4444',
        '--color-error-600': '#dc2626',
        '--color-error-700': '#b91c1c',
        '--color-error-800': '#991b1b',
        '--color-error-900': '#7f1d1d',
        '--color-error-950': '#450a0a',
        '--color-warning-50': '#fffbeb',
        '--color-warning-100': '#fef3c7',
        '--color-warning-200': '#fde68a',
        '--color-warning-300': '#fcd34d',
        '--color-warning-400': '#fbbf24',
        '--color-warning-500': '#f59e0b',
        '--color-warning-600': '#d97706',
        '--color-warning-700': '#b45309',
        '--color-warning-800': '#92400e',
        '--color-warning-900': '#78350f',
        '--color-warning-950': '#451a03',
        '--color-success-50': '#f0fdf4',
        '--color-success-100': '#dcfce7',
        '--color-success-200': '#bbf7d0',
        '--color-success-300': '#86efac',
        '--color-success-400': '#4ade80',
        '--color-success-500': '#22c55e',
        '--color-success-600': '#16a34a',
        '--color-success-700': '#15803d',
        '--color-success-800': '#166534',
        '--color-success-900': '#14532d',
        '--color-success-950': '#052e16',
        '--color-info-50': '#f0f9ff',
        '--color-info-100': '#e0f2fe',
        '--color-info-200': '#bae6fd',
        '--color-info-300': '#7dd3fc',
        '--color-info-400': '#38bdf8',
        '--color-info-500': '#0ea5e9',
        '--color-info-600': '#0284c7',
        '--color-info-700': '#0369a1',
        '--color-info-800': '#075985',
        '--color-info-900': '#0c4a6e',
        '--color-info-950': '#082f49',
      },
      light: {
        '--color-primary-50': '#f0fdf4',
        '--color-primary-100': '#dcfce7',
        '--color-primary-200': '#bbf7d0',
        '--color-primary-300': '#86efac',
        '--color-primary-400': '#4ade80',
        '--color-primary-500': '#22c55e',
        '--color-primary-600': '#16a34a',
        '--color-primary-700': '#15803d',
        '--color-primary-800': '#166534',
        '--color-primary-900': '#14532d',
        '--color-primary-950': '#052e16',
        '--color-secondary-50': '#fefce8',
        '--color-secondary-100': '#fef9c3',
        '--color-secondary-200': '#fef08a',
        '--color-secondary-300': '#fde047',
        '--color-secondary-400': '#facc15',
        '--color-secondary-500': '#eab308',
        '--color-secondary-600': '#ca8a04',
        '--color-secondary-700': '#a16207',
        '--color-secondary-800': '#854d0e',
        '--color-secondary-900': '#713f12',
        '--color-secondary-950': '#422006',
        '--color-accent-50': '#fef2f2',
        '--color-accent-100': '#fee2e2',
        '--color-accent-200': '#fecaca',
        '--color-accent-300': '#fca5a5',
        '--color-accent-400': '#f87171',
        '--color-accent-500': '#ef4444',
        '--color-accent-600': '#dc2626',
        '--color-accent-700': '#b91c1c',
        '--color-accent-800': '#991b1b',
        '--color-accent-900': '#7f1d1d',
        '--color-accent-950': '#450a0a',
        '--color-error-50': '#fef2f2',
        '--color-error-100': '#fee2e2',
        '--color-error-200': '#fecaca',
        '--color-error-300': '#fca5a5',
        '--color-error-400': '#f87171',
        '--color-error-500': '#ef4444',
        '--color-error-600': '#dc2626',
        '--color-error-700': '#b91c1c',
        '--color-error-800': '#991b1b',
        '--color-error-900': '#7f1d1d',
        '--color-error-950': '#450a0a',
        '--color-warning-50': '#fffbeb',
        '--color-warning-100': '#fef3c7',
        '--color-warning-200': '#fde68a',
        '--color-warning-300': '#fcd34d',
        '--color-warning-400': '#fbbf24',
        '--color-warning-500': '#f59e0b',
        '--color-warning-600': '#d97706',
        '--color-warning-700': '#b45309',
        '--color-warning-800': '#92400e',
        '--color-warning-900': '#78350f',
        '--color-warning-950': '#451a03',
        '--color-success-50': '#f0fdf4',
        '--color-success-100': '#dcfce7',
        '--color-success-200': '#bbf7d0',
        '--color-success-300': '#86efac',
        '--color-success-400': '#4ade80',
        '--color-success-500': '#22c55e',
        '--color-success-600': '#16a34a',
        '--color-success-700': '#15803d',
        '--color-success-800': '#166534',
        '--color-success-900': '#14532d',
        '--color-success-950': '#052e16',
        '--color-info-50': '#f0f9ff',
        '--color-info-100': '#e0f2fe',
        '--color-info-200': '#bae6fd',
        '--color-info-300': '#7dd3fc',
        '--color-info-400': '#38bdf8',
        '--color-info-500': '#0ea5e9',
        '--color-info-600': '#0284c7',
        '--color-info-700': '#0369a1',
        '--color-info-800': '#075985',
        '--color-info-900': '#0c4a6e',
        '--color-info-950': '#082f49',
      },
      ocean: {
        '--color-primary-50': '#f0f9ff',
        '--color-primary-100': '#e0f2fe',
        '--color-primary-200': '#bae6fd',
        '--color-primary-300': '#7dd3fc',
        '--color-primary-400': '#38bdf8',
        '--color-primary-500': '#0ea5e9',
        '--color-primary-600': '#0284c7',
        '--color-primary-700': '#0369a1',
        '--color-primary-800': '#075985',
        '--color-primary-900': '#0c4a6e',
        '--color-primary-950': '#082f49',
        '--color-secondary-50': '#f0fdfa',
        '--color-secondary-100': '#ccfbf1',
        '--color-secondary-200': '#99f6e4',
        '--color-secondary-300': '#5eead4',
        '--color-secondary-400': '#2dd4bf',
        '--color-secondary-500': '#14b8a6',
        '--color-secondary-600': '#0d9488',
        '--color-secondary-700': '#0f766e',
        '--color-secondary-800': '#115e59',
        '--color-secondary-900': '#134e4a',
        '--color-secondary-950': '#042f2e',
        '--color-accent-50': '#f0f9ff',
        '--color-accent-100': '#e0f2fe',
        '--color-accent-200': '#bae6fd',
        '--color-accent-300': '#7dd3fc',
        '--color-accent-400': '#38bdf8',
        '--color-accent-500': '#0ea5e9',
        '--color-accent-600': '#0284c7',
        '--color-accent-700': '#0369a1',
        '--color-accent-800': '#075985',
        '--color-accent-900': '#0c4a6e',
        '--color-accent-950': '#082f49',
        '--color-error-50': '#fef2f2',
        '--color-error-100': '#fee2e2',
        '--color-error-200': '#fecaca',
        '--color-error-300': '#fca5a5',
        '--color-error-400': '#f87171',
        '--color-error-500': '#ef4444',
        '--color-error-600': '#dc2626',
        '--color-error-700': '#b91c1c',
        '--color-error-800': '#991b1b',
        '--color-error-900': '#7f1d1d',
        '--color-error-950': '#450a0a',
        '--color-warning-50': '#fffbeb',
        '--color-warning-100': '#fef3c7',
        '--color-warning-200': '#fde68a',
        '--color-warning-300': '#fcd34d',
        '--color-warning-400': '#fbbf24',
        '--color-warning-500': '#f59e0b',
        '--color-warning-600': '#d97706',
        '--color-warning-700': '#b45309',
        '--color-warning-800': '#92400e',
        '--color-warning-900': '#78350f',
        '--color-warning-950': '#451a03',
        '--color-success-50': '#f0fdf4',
        '--color-success-100': '#dcfce7',
        '--color-success-200': '#bbf7d0',
        '--color-success-300': '#86efac',
        '--color-success-400': '#4ade80',
        '--color-success-500': '#22c55e',
        '--color-success-600': '#16a34a',
        '--color-success-700': '#15803d',
        '--color-success-800': '#166534',
        '--color-success-900': '#14532d',
        '--color-success-950': '#052e16',
        '--color-info-50': '#f0f9ff',
        '--color-info-100': '#e0f2fe',
        '--color-info-200': '#bae6fd',
        '--color-info-300': '#7dd3fc',
        '--color-info-400': '#38bdf8',
        '--color-info-500': '#0ea5e9',
        '--color-info-600': '#0284c7',
        '--color-info-700': '#0369a1',
        '--color-info-800': '#075985',
        '--color-info-900': '#0c4a6e',
        '--color-info-950': '#082f49',
      },
      sunset: {
        '--color-primary-50': '#fff7ed',
        '--color-primary-100': '#ffedd5',
        '--color-primary-200': '#fed7aa',
        '--color-primary-300': '#fdba74',
        '--color-primary-400': '#fb923c',
        '--color-primary-500': '#f97316',
        '--color-primary-600': '#ea580c',
        '--color-primary-700': '#c2410c',
        '--color-primary-800': '#9a3412',
        '--color-primary-900': '#7c2d12',
        '--color-primary-950': '#431407',
        '--color-secondary-50': '#fdf2f8',
        '--color-secondary-100': '#fce7f3',
        '--color-secondary-200': '#fbcfe8',
        '--color-secondary-300': '#f9a8d4',
        '--color-secondary-400': '#f472b6',
        '--color-secondary-500': '#ec4899',
        '--color-secondary-600': '#db2777',
        '--color-secondary-700': '#be185d',
        '--color-secondary-800': '#9d174d',
        '--color-secondary-900': '#831843',
        '--color-secondary-950': '#500724',
        '--color-accent-50': '#fefce8',
        '--color-accent-100': '#fef9c3',
        '--color-accent-200': '#fef08a',
        '--color-accent-300': '#fde047',
        '--color-accent-400': '#facc15',
        '--color-accent-500': '#eab308',
        '--color-accent-600': '#ca8a04',
        '--color-accent-700': '#a16207',
        '--color-accent-800': '#854d0e',
        '--color-accent-900': '#713f12',
        '--color-accent-950': '#422006',
        '--color-error-50': '#fef2f2',
        '--color-error-100': '#fee2e2',
        '--color-error-200': '#fecaca',
        '--color-error-300': '#fca5a5',
        '--color-error-400': '#f87171',
        '--color-error-500': '#ef4444',
        '--color-error-600': '#dc2626',
        '--color-error-700': '#b91c1c',
        '--color-error-800': '#991b1b',
        '--color-error-900': '#7f1d1d',
        '--color-error-950': '#450a0a',
        '--color-warning-50': '#fffbeb',
        '--color-warning-100': '#fef3c7',
        '--color-warning-200': '#fde68a',
        '--color-warning-300': '#fcd34d',
        '--color-warning-400': '#fbbf24',
        '--color-warning-500': '#f59e0b',
        '--color-warning-600': '#d97706',
        '--color-warning-700': '#b45309',
        '--color-warning-800': '#92400e',
        '--color-warning-900': '#78350f',
        '--color-warning-950': '#451a03',
        '--color-success-50': '#f0fdf4',
        '--color-success-100': '#dcfce7',
        '--color-success-200': '#bbf7d0',
        '--color-success-300': '#86efac',
        '--color-success-400': '#4ade80',
        '--color-success-500': '#22c55e',
        '--color-success-600': '#16a34a',
        '--color-success-700': '#15803d',
        '--color-success-800': '#166534',
        '--color-success-900': '#14532d',
        '--color-success-950': '#052e16',
        '--color-info-50': '#f0f9ff',
        '--color-info-100': '#e0f2fe',
        '--color-info-200': '#bae6fd',
        '--color-info-300': '#7dd3fc',
        '--color-info-400': '#38bdf8',
        '--color-info-500': '#0ea5e9',
        '--color-info-600': '#0284c7',
        '--color-info-700': '#0369a1',
        '--color-info-800': '#075985',
        '--color-info-900': '#0c4a6e',
        '--color-info-950': '#082f49',
      },
      night: {
        '--color-primary-50': '#f8fafc',
        '--color-primary-100': '#f1f5f9',
        '--color-primary-200': '#e2e8f0',
        '--color-primary-300': '#cbd5e1',
        '--color-primary-400': '#94a3b8',
        '--color-primary-500': '#64748b',
        '--color-primary-600': '#475569',
        '--color-primary-700': '#334155',
        '--color-primary-800': '#1e293b',
        '--color-primary-900': '#0f172a',
        '--color-primary-950': '#020617',
        '--color-secondary-50': '#faf5ff',
        '--color-secondary-100': '#f3e8ff',
        '--color-secondary-200': '#e9d5ff',
        '--color-secondary-300': '#d8b4fe',
        '--color-secondary-400': '#c084fc',
        '--color-secondary-500': '#a855f7',
        '--color-secondary-600': '#9333ea',
        '--color-secondary-700': '#7c3aed',
        '--color-secondary-800': '#6b21a8',
        '--color-secondary-900': '#581c87',
        '--color-secondary-950': '#3b0764',
        '--color-accent-50': '#f0f9ff',
        '--color-accent-100': '#e0f2fe',
        '--color-accent-200': '#bae6fd',
        '--color-accent-300': '#7dd3fc',
        '--color-accent-400': '#38bdf8',
        '--color-accent-500': '#0ea5e9',
        '--color-accent-600': '#0284c7',
        '--color-accent-700': '#0369a1',
        '--color-accent-800': '#075985',
        '--color-accent-900': '#0c4a6e',
        '--color-accent-950': '#082f49',
        '--color-error-50': '#fef2f2',
        '--color-error-100': '#fee2e2',
        '--color-error-200': '#fecaca',
        '--color-error-300': '#fca5a5',
        '--color-error-400': '#f87171',
        '--color-error-500': '#ef4444',
        '--color-error-600': '#dc2626',
        '--color-error-700': '#b91c1c',
        '--color-error-800': '#991b1b',
        '--color-error-900': '#7f1d1d',
        '--color-error-950': '#450a0a',
        '--color-warning-50': '#fffbeb',
        '--color-warning-100': '#fef3c7',
        '--color-warning-200': '#fde68a',
        '--color-warning-300': '#fcd34d',
        '--color-warning-400': '#fbbf24',
        '--color-warning-500': '#f59e0b',
        '--color-warning-600': '#d97706',
        '--color-warning-700': '#b45309',
        '--color-warning-800': '#92400e',
        '--color-warning-900': '#78350f',
        '--color-warning-950': '#451a03',
        '--color-success-50': '#f0fdf4',
        '--color-success-100': '#dcfce7',
        '--color-success-200': '#bbf7d0',
        '--color-success-300': '#86efac',
        '--color-success-400': '#4ade80',
        '--color-success-500': '#22c55e',
        '--color-success-600': '#16a34a',
        '--color-success-700': '#15803d',
        '--color-success-800': '#166534',
        '--color-success-900': '#14532d',
        '--color-success-950': '#052e16',
        '--color-info-50': '#f0f9ff',
        '--color-info-100': '#e0f2fe',
        '--color-info-200': '#bae6fd',
        '--color-info-300': '#7dd3fc',
        '--color-info-400': '#38bdf8',
        '--color-info-500': '#0ea5e9',
        '--color-info-600': '#0284c7',
        '--color-info-700': '#0369a1',
        '--color-info-800': '#075985',
        '--color-info-900': '#0c4a6e',
        '--color-info-950': '#082f49',
      },
      mono: {
        '--color-primary-50': '#f8fafc',
        '--color-primary-100': '#f1f5f9',
        '--color-primary-200': '#e2e8f0',
        '--color-primary-300': '#cbd5e1',
        '--color-primary-400': '#94a3b8',
        '--color-primary-500': '#64748b',
        '--color-primary-600': '#475569',
        '--color-primary-700': '#334155',
        '--color-primary-800': '#1e293b',
        '--color-primary-900': '#0f172a',
        '--color-primary-950': '#020617',
        '--color-secondary-50': '#f9fafb',
        '--color-secondary-100': '#f3f4f6',
        '--color-secondary-200': '#e5e7eb',
        '--color-secondary-300': '#d1d5db',
        '--color-secondary-400': '#9ca3af',
        '--color-secondary-500': '#6b7280',
        '--color-secondary-600': '#4b5563',
        '--color-secondary-700': '#374151',
        '--color-secondary-800': '#1f2937',
        '--color-secondary-900': '#111827',
        '--color-secondary-950': '#030712',
        '--color-accent-50': '#fafafa',
        '--color-accent-100': '#f4f4f5',
        '--color-accent-200': '#e4e4e7',
        '--color-accent-300': '#d4d4d8',
        '--color-accent-400': '#a1a1aa',
        '--color-accent-500': '#71717a',
        '--color-accent-600': '#52525b',
        '--color-accent-700': '#3f3f46',
        '--color-accent-800': '#27272a',
        '--color-accent-900': '#18181b',
        '--color-accent-950': '#09090b',
        '--color-error-50': '#fef2f2',
        '--color-error-100': '#fee2e2',
        '--color-error-200': '#fecaca',
        '--color-error-300': '#fca5a5',
        '--color-error-400': '#f87171',
        '--color-error-500': '#ef4444',
        '--color-error-600': '#dc2626',
        '--color-error-700': '#b91c1c',
        '--color-error-800': '#991b1b',
        '--color-error-900': '#7f1d1d',
        '--color-error-950': '#450a0a',
        '--color-warning-50': '#fffbeb',
        '--color-warning-100': '#fef3c7',
        '--color-warning-200': '#fde68a',
        '--color-warning-300': '#fcd34d',
        '--color-warning-400': '#fbbf24',
        '--color-warning-500': '#f59e0b',
        '--color-warning-600': '#d97706',
        '--color-warning-700': '#b45309',
        '--color-warning-800': '#92400e',
        '--color-warning-900': '#78350f',
        '--color-warning-950': '#451a03',
        '--color-success-50': '#f0fdf4',
        '--color-success-100': '#dcfce7',
        '--color-success-200': '#bbf7d0',
        '--color-success-300': '#86efac',
        '--color-success-400': '#4ade80',
        '--color-success-500': '#22c55e',
        '--color-success-600': '#16a34a',
        '--color-success-700': '#15803d',
        '--color-success-800': '#166534',
        '--color-success-900': '#14532d',
        '--color-success-950': '#052e16',
        '--color-info-50': '#f0f9ff',
        '--color-info-100': '#e0f2fe',
        '--color-info-200': '#bae6fd',
        '--color-info-300': '#7dd3fc',
        '--color-info-400': '#38bdf8',
        '--color-info-500': '#0ea5e9',
        '--color-info-600': '#0284c7',
        '--color-info-700': '#0369a1',
        '--color-info-800': '#075985',
        '--color-info-900': '#0c4a6e',
        '--color-info-950': '#082f49',
      },
    };

    const colors = paletteMap[palette];
    Object.entries(colors).forEach(([property, value]) => {
      root.style.setProperty(property, value);
    });
  };

  // Inicjalizacja CSS variables przy pierwszym renderowaniu
  useEffect(() => {
    updateCSSVariables(currentPalette);
  }, [currentPalette]);

  const value: ThemeContextType = {
    currentPalette,
    setPalette,
    availablePalettes,
  };

  return (
    <ThemeContext.Provider value={value}>
      {children}
    </ThemeContext.Provider>
  );
};

export const useTheme = (): ThemeContextType => {
  const context = useContext(ThemeContext);
  if (context === undefined) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
};
